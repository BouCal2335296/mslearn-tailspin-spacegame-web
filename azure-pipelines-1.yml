trigger:
- main

pool:
  vmImage: 'windows-latest'

variables:
  buildConfiguration: 'Release'
  wwwrootDir: 'Tailspin.SpaceGame.Web/wwwroot'
  dotnetSdkVersion: '6.x'

steps:
# Étape 1 : Installation du SDK .NET
- task: UseDotNet@2
  displayName: 'Install .NET SDK $(dotnetSdkVersion)'
  inputs:
    packageType: 'sdk'
    version: '$(dotnetSdkVersion)'

# Étape 2 : Restauration des dépendances
- script: dotnet restore
  displayName: 'Restore dependencies'

# Étape 3 : Build du projet avec la configuration spécifiée
- script: dotnet build --configuration $(buildConfiguration) --no-restore
  displayName: 'Build project ($(buildConfiguration))'

# Étape 4 : Exécution des tests
- script: dotnet test --configuration $(buildConfiguration) --no-build --verbosity normal
  displayName: 'Run unit tests'

# Étape 5 : Compilation des fichiers Sass en CSS
- script: './node_modules/.bin/node-sass $(wwwrootDir) --output $(wwwrootDir)'
  displayName: 'Compile Sass assets ($(wwwrootDir))'

# Étape 6 : Publication des artefacts
- script: dotnet publish --configuration $(buildConfiguration) --output $(Build.ArtifactStagingDirectory)
  displayName: 'Publish project ($(buildConfiguration))'

# Étape 7 : Téléversement de l’artefact de build
- task: PublishBuildArtifacts@1
  displayName: 'Upload artifact'
  inputs:
    PathtoPublish: '$(Build.ArtifactStagingDirectory)'
    ArtifactName: 'drop'
    publishLocation: 'Container'
